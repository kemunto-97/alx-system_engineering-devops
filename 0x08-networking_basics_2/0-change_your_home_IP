#!/usr/bin/env bash
# Check if the script is run with root privileges
if [ "$EUID" -ne 0 ]; then
    echo "Please run this script as root."
    exit 1
fi

# Function to add/update an entry in /etc/hosts
update_hosts_file() {
    local ip_address="$1"
    local hostname="$2"

    if ! grep -qE "^\s*$ip_address\s+$hostname\s*$" /etc/hosts; then
        echo "$ip_address $hostname" >> /etc/hosts
    fi
}

# Update the server
apt-get update && apt-get upgrade -y

# Install necessary packages (dnsutils for nslookup)
apt-get install -y dnsutils

# Update /etc/hosts with the desired entries
update_hosts_file "127.0.0.2" "localhost"
update_hosts_file "8.8.8.8" "facebook.com"

# Check if Docker is installed
if ! command -v docker &>/dev/null; then
    echo "Docker is not installed. Please install Docker to continue."
    exit 1
fi

# Configure Docker DNS settings (use Google's public DNS)
mkdir -p /etc/docker
echo '{"dns": ["8.8.8.8", "8.8.4.4"]}' > /etc/docker/daemon.json

# Restart Docker to apply the DNS settings
systemctl restart docker

echo "Configuration completed successfully."
